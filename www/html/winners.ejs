<% include partials/head %>
<%- include("partials/header", { user: !!locals.user ? user : undefined, admin: admin }) %>

<style>
  .entry {
    background-color: #252525;
    font-size: 20px;
    color: white;
    width: 310px;
    height: auto;
    margin: 6.9px;
    bottom: 0px;
    box-sizing: border-box;
    left: 0px;
    letter-spacing: 0.3px;
    overflow-wrap: break-word;
    position: relative;
    right: 0px;
    text-align: left;
    text-decoration: none solid rgb(0, 0, 0);
    text-rendering: optimizelegibility;
    text-size-adjust: 100%;
    top: 0px;
    width: 224px;
    column-rule-color: rgb(0, 0, 0);
    perspective-origin: 112px 200.188px;
    transform-origin: 112px 200.188px;
    caret-color: rgb(0, 0, 0);
    border: 0px none rgb(0, 0, 0);
    font-size: 15px;
    list-style: none outside none;
    outline: rgb(255, 255, 255) none 0px;
    min-height: 220px;
  }

  .authoricon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    vertical-align: middle;
  }

  .authorname {
    vertical-align: middle;
  }
</style>

<div class="votenotice" style="font-size:30px;">You can vote for ... more modders.</div>

<div class="reswarning" style="font-size:40px;display:none;color:red;">Your resolution is too low to view this website.</div>

<ul class="authorwrapper wrapper hidden">
  <% for (var author of authors) { %>
    <div id="<%= author.id %>" class="entry authorentry authorentry<%= author.id %> entry<%= author.id %> authorentry<%= author.discordids.split(',').join(' authorentry') %> entry<%= author.discordids.split(',').join(' entry') %>">
      <img class="authoricon" src="<%= author.icon %>">
      <a class="authorname notalink"><%= author.name %></a>
      <button class="votebutton vote votefor<%= author.id %> votefor<%= author.discordids.split(',').join(' votefor') %>" onclick="vote('<%= author.id %>')" <% if (votes.includes(author.id)) { %> style="display:none;"<% } %>>VOTE</button>
      <button class="votebutton unvote unvotefor<%= author.id %> unvotefor<%= author.discordids.split(',').join(' unvotefor') %>" onclick="unvote('<%= author.id %>')" <% if (!votes.includes(author.id)) { %> style="display:none;"<% } %>>VOTED</button>
      <br><br>
      <ul>
        <% for (var mod of mods) { %>
          <% if (mod.authors.includes(author.id)) { %>
            <li><a href="#mods#<%= mod.id %>"><%= mod.name %></a></li>
          <% } %>
        <% } %>
      </ul>
      <br>
    </div>
  <% } %>
</ul>

<ul class="modwrapper wrapper hidden">
  <% for (var mod of mods) { %>
    <div id="<%= mod.id %>" class="entry modentry <% for (var author of mod.authors) { for (var author2 of authors) { if (author == author2.id) { %> modentry<%= author2.id %> entry<%= author2.id %> <% }}} %>">
      <img src="<%= mod.image %>"><br><br class="shrink">
      <a class="modname notalink"><%= mod.name %></a><br><br>
      <div class="moddescription"><%= mod.description.replace(/<\s*br[\s\\\/]*>/gi, "\n").replace(/ +/g, " ") %></div><br><br class="shrink">
      <a class="moddescription" href="https://nexusmods.com/<%= mod.domain %>/mods/<%= mod.nexusid %>">View on NexusMods</a>
      <ul class="modauthors">
        <% var lines = 0; %>
        <% for (var author of mod.authors) { %>
          <% for (var author2 of authors) { %>
            <% if (author == author2.id) { %>
              <li>
                <img class="authoricon" src="<%= author2.icon %>">
                <a href="#authors#<%= author2.id %>"><%= author2.name %></a>
                <button class="votebutton modvotebutton vote votefor<%= author2.id %> votefor<%= author2.discordids.split(',').join(' votefor') %>" onclick="vote('<%= author2.id %>')" <% if (votes.includes(author2.id)) { %> style="display:none;"<% } %>>VOTE</button>
                <button class="votebutton modvotebutton unvote unvotefor<%= author2.id %> unvotefor<%= author2.discordids.split(',').join(' unvotefor') %>" onclick="unvote('<%= author2.id %>')" <% if (!votes.includes(author2.id)) { %> style="display:none;"<% } %>>VOTED</button>
                <br>
              </li>
              <% lines++; %>
              <% continue; %>
            <% } %>
          <% } %>
        <% } %>
      </ul>
      <br><br>
      <% for (var i = 0; i < lines; i++) { %>
        <br><br>
      <% } %>
    </div>
  <% } %>
</ul>

<% if (locals.admin) { %>
  <div class="votewrapper wrapper hidden">
    <ul class="votewrapper wrapper hidden">
      <% for (var author of authors) { %>
        <div id="<%= author.id %>" class="entry authorentry authorentry<%= author.id %> entry<%= author.id %> authorentry<%= author.discordids.split(',').join(' authorentry') %> entry<%= author.discordids.split(',').join(' entry') %> voteentry">
          <img class="authoricon" src="<%= author.icon %>">
          <a class="authorname notalink"><%= author.name %></a>
          <br><br>
          <div class="votes<%= author.id %>" style="text-align:center;font-size:112px;">...</div>
          <script>
            $(window).on("load", () => { 
              setInterval(() => {
                try {
                  $(".votes<%= author.id %>").text(window.totalvotes.<%= author.id %>.length);
                  $(".votes<%= author.id %>").fitText(0.2);
                } catch (e) {
                  $(".votes<%= author.id %>").text("...");
                  $(".votes<%= author.id %>").fitText(0.2);
                }
              }, 100)
            });
          </script>
          <br>
        </div>
      <% } %>
    </ul>
    <button onclick="if(window.confirm('Are you sure you want to remove all votes?')) removeAllVotes()">Remove all votes</button>
  </div>
<% } %>

<form name="dirty_check"><input type="hidden" id="page_is_dirty" name="page_is_dirty" value="0"/></form>